<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nossa Musica</title>
    <!-- Configura√ß√µes PWA e iOS -->
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Nossa M√∫sica">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    <meta name="theme-color" content="#1DB954">
    <!-- Favicon (√≠cone da aba) -->
    <link id="favicon" rel="icon" href="#">
    <!-- Tailwind CSS para estiliza√ß√£o r√°pida e responsiva -->
    <style>
        /* Estilos personalizados para complementar o Tailwind */
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #121212; /* Cor de fundo escura padr√£o do Spotify */
        }

        /* Estilizando a barra de rolagem para um visual mais limpo */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1e1e1e;
        }
        ::-webkit-scrollbar-thumb {
            background: #535353;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #7a7a7a;
        }
        
        /* Transi√ß√£o suave entre as p√°ginas */
        .page {
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .page.hidden {
            transform: translateX(100%);
        }
        #lyrics-page.hidden {
             transform: translateY(100%);
        }
        
        /* Anima√ß√£o de pulso para o bot√£o Play */
        .pulse-play {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.7); }
            70% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(255, 255, 255, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 255, 255, 0); }
        }
        
        /* Cor verde para bot√µes ativos */
        .active-icon {
            color: #1DB954; /* Verde Spotify */
        }
        
        /* Anima√ß√£o para senha incorreta */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
            20%, 40%, 60%, 80% { transform: translateX(10px); }
        }
        .animate-shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }

    </style>
    <script>
        // Fun√ß√£o para lidar com erros de imagem. Colocada no <head> para garantir que esteja definida antes do <body> ser renderizado.
        function handleImageError(image) {
            // Se a imagem .jpg falhar, tenta carregar a .png
            const currentSrc = image.src;
            if (currentSrc.endsWith('.jpg')) {
                image.onerror = null; // Evita um loop infinito se o .png tamb√©m falhar
                image.src = currentSrc.replace('.jpg', '.png');
            }
        }
    </script>
</head>
<body class="bg-black text-white overflow-hidden">
    <!-- P√ÅGINA DE SENHA -->
    <div id="password-page" class="fixed inset-0 bg-[#121212] flex flex-col items-center justify-center z-[200]">
        <div class="text-center p-4">
            <h1 class="text-3xl font-bold mb-2 text-white">Nossa M√∫sica</h1>
            <p class="text-gray-400 mb-8">Por favor, insira a senha para continuar.</p>
            <form id="password-form" class="flex flex-col items-center">
                <input type="password" id="password-input" class="bg-[#282828] border-2 border-transparent focus:border-[#1DB954] text-white text-center text-sm rounded-lg focus:ring-0 block w-64 p-2.5 mb-4 transition-all duration-300" placeholder="********" required>
                <button type="submit" class="bg-[#1DB954] hover:bg-green-600 text-white font-bold py-2 px-8 rounded-full transition-transform hover:scale-105">
                    Entrar
                </button>
                <p id="error-message" class="text-red-500 text-sm mt-4 hidden">Senha incorreta. Tente novamente.</p>
            </form>
        </div>
    </div>
    
    <!-- Conte√∫do principal da aplica√ß√£o (inicialmente oculto) -->
    <div id="app-container" class="hidden">
        <!-- NOTIFICA√á√ÉO DE M√öSICA (E AGORA DE STATUS DO CACHE) -->
        <div id="notification" class="fixed top-10 left-1/2 -translate-x-1/2 bg-[#1DB954] text-white px-6 py-3 rounded-full shadow-lg text-sm font-semibold z-[100] opacity-0 transition-all duration-500 ease-in-out pointer-events-none transform -translate-y-10">
            <span id="notification-song-name"></span>
        </div>

        <!-- Player de √°udio invis√≠vel -->
        <audio id="audio-player" crossorigin="anonymous"></audio>

        <!-- Container principal que segura as duas "p√°ginas" -->
        <div class="relative h-screen w-full">

            <!-- P√ÅGINA PRINCIPAL (com rolagem) -->
            <div id="main-page" class="absolute inset-0 page bg-[#121212] overflow-y-auto">
                <div class="container mx-auto max-w-lg min-h-full flex flex-col px-4 pt-10 pb-4">
                    <!-- CABE√áALHO -->
                    <header class="flex justify-between items-center mb-6 flex-shrink-0">
                        <div class="w-6 h-6"></div>
                        <span class="text-sm font-bold">Tocando Agora</span>
                        <div class="relative">
                            <button id="menu-btn" class="focus:outline-none">
                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"></path></svg>
                            </button>
                            <div id="header-menu" class="hidden absolute right-0 mt-2 w-48 bg-[#282828] rounded-md shadow-lg z-50">
                                <a href="https://wa.me/5515981072147" target="_blank" class="flex items-center space-x-3 px-4 py-3 text-sm text-white hover:bg-[#3e3e3e] rounded-md">
                                    <!-- WhatsApp Icon SVG -->
                                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.487 5.235 3.487 8.413 0 6.557-5.338 11.892-11.894 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 4.315 1.731 6.086l.001.004l.351.568l-1.251 4.605l4.672-1.225l.531.315z"></path></svg>
                                    <span>Enviar no WhatsApp</span>
                                </a>
                                <!-- NOVO BOT√ÉO DE DOWNLOAD OFFLINE -->
                                <button id="download-offline-btn" class="flex items-center space-x-3 px-4 py-3 text-sm text-white hover:bg-[#3e3e3e] rounded-md w-full text-left">
                                    <!-- Download Icon SVG -->
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                                    <span id="download-offline-text">Salvar para Offline</span>
                                </button>
                                <!-- FIM DO NOVO BOT√ÉO -->
                            </div>
                        </div>
                    </header>

                    <main class="flex-grow">
                        <!-- CAPA DA M√öSICA -->
                        <div class="mb-6">
                            <div id="album-art-container" class="relative w-full rounded-lg shadow-2xl aspect-square overflow-hidden">
                                <!-- Imagens ser√£o inseridas aqui via JavaScript -->
                            </div>
                        </div>

                        <!-- T√çTULO E ARTISTA -->
                        <div class="flex justify-between items-center mb-4">
                            <div>
                                <h1 id="song-title" class="text-2xl font-bold"></h1>
                                <p id="song-artist" class="text-gray-400"></p>
                            </div>
                            <svg class="w-6 h-6 text-green-500" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                        </div>

                        <!-- CONTROLES DE M√öSICA -->
                        <div class="mb-8">
                            <div id="main-progress-bar" class="bg-gray-700 rounded-full h-1 w-full mb-1 cursor-pointer"><div id="main-progress" class="bg-white rounded-full h-1" style="width: 0%;"></div></div>
                            <div class="flex justify-between text-xs text-gray-400"><span id="main-current-time">0:00</span><span id="main-total-time">0:00</span></div>
                            <div class="flex justify-center items-center space-x-8 mt-4 px-4">
                                <button id="main-prev-btn">
                                    <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M8.445 14.832A1 1 0 0010 14.006V5.994a1 1 0 00-1.555-.832L2.4 9.168a1 1 0 000 1.664l6.045 4.001zM11 5h2v10h-2V5z" clip-rule="evenodd"></path></svg>
                                </button>
                                <button id="main-play-btn" class="w-12 h-12 text-white rounded-full"></button>
                                <button id="main-next-btn">
                                    <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M11.555 5.168A1 1 0 0010 5.994v8.012a1 1 0 001.555.832l6.045-4.001a1 1 0 000-1.664l-6.045-4.001zM9 5H7v10h2V5z" clip-rule="evenodd"></path></svg>
                                </button>
                            </div>
                        </div>
                        
                        <!-- SELE√á√ÉO DE LETRA (NOVO) -->
                        <nav class="flex justify-center space-x-4 mb-4">
                            <button id="main-our-lyrics-tab" class="py-2 px-4 font-bold text-white border-b-2 border-white">
                                Nossa Letra
                            </button>
                            <button id="main-song-lyrics-tab" class="py-2 px-4 font-bold text-white/70 border-b-2 border-transparent">
                                M√∫sica
                            </button>
                        </nav>

                        <!-- CARD "LETRA" -->
                        <div id="lyrics-card" class="bg-[#191414] rounded-lg p-6 cursor-pointer mb-8 flex flex-col items-start">
                            <h2 id="lyrics-card-title" class="text-xl font-bold mb-2">Nossa Letra</h2>
                            <p id="lyrics-card-preview" class="text-gray-300 text-sm mb-4">Sabe de uma coisa? Voc√™ sempre foi a minha primeira op√ß√£o, a minha paix√£o de anos e anos. Eu lembro que sempre que come√ßava a conhecer uma menina, eu n√£o deixava passar demais porque eu era apaixonado por voc√™...</p>
                            <button class="bg-white text-black text-sm font-bold py-2 px-4 rounded-full hover:scale-105 transition-transform">
                                Mostrar Letra
                            </button>
                        </div>

                        <!-- SE√á√ÉO DE STORIES -->
                        <div class="mb-8">
                             <h2 class="text-xl font-bold mb-4">Momentos Especiais</h2>
                             <div id="stories-container" class="flex space-x-4 overflow-x-auto pb-4"></div>
                        </div>

                         <!-- SE√á√ÉO PLAYLISTS -->
                        <div class="mb-8">
                            <h2 class="text-xl font-bold mb-4">Playlists</h2>
                            <div class="space-y-4">
                                <!-- Playlist 1 -->
                                <a href="https://open.spotify.com/playlist/2VEp6ezA9cZspGtFuC8kHl?si=pp7JQThBTAGuqG1B6dZ19A&pi=Lr_mp7DARK6Xj" target="_blank" class="bg-[#191414] rounded-lg p-4 flex items-center space-x-4 cursor-pointer hover:bg-[#282828] transition-colors">
                                    <img src="s1.jpg" alt="Playlist Good Music, Be Happy" class="w-24 h-24 rounded-lg object-cover flex-shrink-0" onerror="handleImageError(this)">
                                    <div class="flex-grow">
                                        <p class="text-gray-400 text-sm">Playlist</p>
                                        <h3 class="text-lg font-bold">Good Music, Be Happy</h3>
                                    </div>
                                </a>
                                <!-- Playlist 2 -->
                                <a href="https://open.spotify.com/playlist/3IdSP2AjrYdtEtM1Vznjg1?si=LkmcW2SfQoS-oPTbqrPUkQ&pi=9SewqA1mTx2fl" target="_blank" class="bg-[#191414] rounded-lg p-4 flex items-center space-x-4 cursor-pointer hover:bg-[#282828] transition-colors">
                                    <img src="s2.jpg" alt="Playlist Te Pago um Salgado" class="w-24 h-24 rounded-lg object-cover flex-shrink-0" onerror="handleImageError(this)">
                                    <div class="flex-grow">
                                        <p class="text-gray-400 text-sm">Playlist</p>
                                        <h3 class="text-lg font-bold">Te Pago um Salgado</h3>
                                    </div>
                                </a>
                                <!-- Playlist 3 -->
                                <a href="https://open.spotify.com/playlist/7zUqPDhQbajlh1FEZZkcv8?si=OGF4o5TGScumCCLzlr_DRg&pi=W0--_0lKRWuNs" target="_blank" class="bg-[#191414] rounded-lg p-4 flex items-center space-x-4 cursor-pointer hover:bg-[#282828] transition-colors">
                                    <img src="s3.jpg" alt="Playlist Nossa M√∫sica üíï" class="w-24 h-24 rounded-lg object-cover flex-shrink-0" onerror="handleImageError(this)">
                                    <div class="flex-grow">
                                        <p class="text-gray-400 text-sm">Playlist</p>
                                        <div class="flex items-center">
                                            <h3 class="text-lg font-bold">Nossa M√∫sica üíï</h3>
                                            <span class="ml-2 bg-[#1DB954] text-white text-xs font-bold px-2 py-0.5 rounded-full">NEW</span>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </div>

                        <!-- SE√á√ÉO EVENTOS -->
                        <div class="mb-8">
                             <h2 class="text-xl font-bold mb-4">Eventos</h2>
                             <div id="events-container" class="flex space-x-4 overflow-x-auto pb-4"></div>
                        </div>

                        <!-- SE√á√ÉO ARTISTA -->
                        <div class="mb-8">
                             <h2 class="text-xl font-bold mb-4">Sobre o Artista</h2>
                             <div class="bg-[#191414] rounded-lg p-4 flex items-center space-x-6">
                                 <img src="minhafoto.jpg" alt="Foto do Artista" class="w-28 h-28 rounded-full object-cover flex-shrink-0" onerror="handleImageError(this)">
                                 <div>
                                     <h3 class="text-lg font-bold">Guilherme Almeida</h3>
                                     <p class="text-gray-400 text-sm">Apenas um garoto apaixonado por musica que sempre dividiu playlist com sua melhor amiga, e que hoje quer dividir a sua vida com ela, Que Sorte a Dele!</p>
                                 </div>
                             </div>
                        </div>
                    </main>
                </div>
            </div>

            <!-- P√ÅGINA DA LETRA (com layout fixo) -->
            <!-- CORRE√á√ÉO: Usando 'flex flex-col' para garantir o layout de rodap√© fixo -->
            <div id="lyrics-page" class="absolute inset-0 page bg-[#191414] hidden flex flex-col">
                <!-- Cabe√ßalho da p√°gina de letra (Fixo) -->
                <header class="flex justify-between items-center p-4 z-10 pt-10 flex-shrink-0">
                    <button id="back-to-main-btn">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                    </button>
                    <span id="lyrics-song-title" class="text-sm font-bold text-white"></span>
                    <div class="w-6 h-6"></div>
                </header>

                <!-- Conte√∫do da Letra (Rol√°vel) -->
                <!-- CORRE√á√ÉO: 'flex-1' faz com que este div ocupe o espa√ßo restante e 'overflow-y-auto' o torna rol√°vel -->
                <div id="lyrics-content" class="flex-1 overflow-y-auto px-6 pt-8 pb-8">
                    
                    <!-- Conte√∫do "Nossa Letra" (Original) -->
                    <!-- NOTA: 'hidden' N√ÉO est√° aqui por padr√£o, ser√° adicionado/removido via JS -->
                    <div id="our-lyrics-content" class="text-white text-xl font-bold space-y-4 text-center">
                        <p>Sabe de uma coisa? Sempre foi voc√™, a minha paix√£o de anos. Lembro que, na √©poca dos meus 17 anos e dos seus 14, eu sempre me afastava de qualquer outra garota porque, no fundo, eu era apaixonado por voc√™.</p>
                        <p>N√£o sei dizer exatamente quando isso come√ßou, talvez eu fosse mais novo ainda, mas eu tinha uma unica ideia na minha mente: "Quando ela fizer 18 anos, eu converso com ela". Eu tinha essa certeza de que voc√™, minha melhor amiga, seria minha esposa. Era com voc√™ que eu queria me casar desde aquela √©poca. Eu gostava tanto de voc√™ que eu lembro de esperar anos por esse momento.</p>
                        <p>Mas eu, como a pessoa mais imatura da face da terra, em fevereiro de 2020 ‚Äî nove meses antes de voc√™ fazer 18 ‚Äî combinei de sair com a Mari para conversar sobre isso, porque eu queria me preparar melhor para esse evento.</p>
                        <p>S√≥ que a Mari conversou com voc√™ e voltou com um banho de √°gua fria. Ela disse que eu poderia estragar nossa amizade. O medo de que isso acontecesse, o medo de te afastar, foi t√£o grande que eu simplesmente deixei aquele sonho de lado.</p>
                        <p>O tempo passou e as coisas foram acontecendo. Eu namorei, terminei. Precisei de alguns meses para me recuperar e, quando me senti pronto para outro relacionamento, n√£o vou mentir: eu pensava em voc√™. Mas eu ainda estava travado. Tivemos alguns momentos inoportunos...</p>
                        <p>E com o tempo, essa trava foi enfraquecendo. Enfim, foi tanta hist√≥ria, tanto vai e vem, para no final tudo nos levar √†quele fim de semana s√≥ nosso no Rio de Janeiro. Aonde, tivemos tempo para nos reaproximar e reconectar e as horas e horas de conversa no √¥nibus foram essenciais. Finalmente, pudemos dar uma chance ao nosso antigo "gostava de voc√™ naquela √©poca".</p>
                        <p>Hoje, vejo tudo com muito mais clareza. Percebo que tamb√©m falhei com voc√™ por n√£o ter tomado uma atitude antes. J√° era para estarmos juntos h√° muito tempo (talvez com cinco filhos j√°, brincadeira!), vivendo nossas vidas. Me desculpa por demorar tanto para isso acontecer. A vida brincou demais com a gente, mas seria muito injusto com n√≥s mesmos se n√£o d√©ssemos uma chance a isso.</p>
                        <p>Sinto que agora √© o momento certo. Estamos mais maduros, mais preparados para reviver isso e dar in√≠cio √† nossa hist√≥ria de amor. E se voc√™ me permitir, daqui em diante, voc√™ ser√° a minha garota. Aquela que eu irei cuidar e apoiar eternamente.</p>
                        <p>Eu nunca vou esquecer o sorriso que voc√™ deu no √¥nibus, depois da nossa conversa. Foi t√£o lindo me quebrou na hora. Eu quero ver esse sorriso sempre. Quero te fazer feliz e estar ao seu lado nos momentos bons e ruins, como sempre estive; s√≥ que agora, n√£o apenas como seu melhor amigo, mas como seu namorado, noivo e futuro esposo.</p>
                        <p>Estava olhando nossa galeria de fotos... a gente tem tanta hist√≥ria. N√≥s praticamente crescemos juntos. Foi muito legal criar esse "mini Spotify" de hist√≥ria para voc√™; relembrei tanta coisa que passamos e o quanto foi bom estar ao seu lado todos esses anos. O incr√≠vel √© que, com voc√™, nada √© complicado √© tudo leve.</p>
                        <p>Eu quero viver a leveza que √© estar ao seu lado: conhecer novos lugares, viajar, servir a Jeov√° juntos e construir nossa fam√≠lia.</p>
                        <p>Que a partir de hoje, a gente n√£o precise adiar mais nada e que possamos ser ainda mais felizes juntos. E que a trilha sonora do nosso amor nunca tenha fim.</p>
                        <p>Eu amo voc√™ Ju, Eu sempre amei!</p>
                    </div>

                    <!-- Conte√∫do "M√∫sica" (Novo) -->
                    <!-- As letras das m√∫sicas ser√£o inseridas aqui via JS -->
                    <!-- NOTA: 'hidden' EST√Å aqui por padr√£o, ser√° adicionado/removido via JS -->
                    <div id="song-lyrics-content" class="hidden text-white text-xl font-bold space-y-4 text-center whitespace-pre-line">
                        <!-- O 'whitespace-pre-line' √© importante para respeitar as quebras de linha (\n) da letra -->
                    </div>
                </div>

                <!-- Mini Player Fixo (Fixo) -->
                <footer class="p-4 bg-[#191414] flex-shrink-0">
                    <div id="lyrics-progress-bar" class="bg-white/30 rounded-full h-1 w-full mb-1 cursor-pointer"><div id="lyrics-progress" class="bg-white rounded-full h-1" style="width: 0%;"></div></div>
                    <div class="flex justify-between text-xs text-white/80"><span id="lyrics-current-time">0:00</span><span id="lyrics-total-time">0:00</span></div>
                    <div class="flex justify-center items-center space-x-8 mt-4">
                         <button id="lyrics-prev-btn">
                            <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M8.445 14.832A1 1 0 0010 14.006V5.994a1 1 0 00-1.555-.832L2.4 9.168a1 1 0 000 1.664l6.045 4.001zM11 5h2v10h-2V5z" clip-rule="evenodd"></path></svg>
                         </button>
                         <button id="lyrics-play-btn" class="w-12 h-12 text-white"></button>
                         <button id="lyrics-next-btn">
                            <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M11.555 5.168A1 1 0 0010 5.994v8.012a1 1 0 001.555.832l6.045-4.001a1 1 0 000-1.664l-6.045-4.001zM9 5H7v10h2V5z" clip-rule="evenodd"></path></svg>
                         </button>
                    </div>
                </footer>
            </div>

        </div>


        <!-- MODAL DO STORY (inicialmente oculto) -->
        <div id="story-modal" class="fixed inset-0 bg-black flex-col p-4 z-50 hidden">
            <div class="flex items-center justify-between mb-2 pt-6 z-10">
                <div class="flex items-center space-x-2">
                     <img id="story-modal-avatar" src="" class="w-8 h-8 rounded-full object-cover" onerror="handleImageError(this)">
                     <span id="story-modal-title" class="font-semibold text-sm"></span>
                </div>
                 <div class="flex items-center space-x-4">
                    <button id="story-pause-btn" class="text-white w-6 h-6"></button>
                    <button id="close-story-btn" class="text-white text-2xl">&times;</button>
                </div>
            </div>
            <div class="relative flex-grow w-full h-full rounded-lg overflow-hidden">
                <img id="story-modal-image" src="" class="absolute top-0 left-0 w-full h-full object-contain transition-opacity duration-300 opacity-0" onerror="handleImageError(this)">
                <!-- Camadas de navega√ß√£o -->
                <div id="story-prev-zone" class="absolute left-0 top-0 h-full w-1/3 z-20"></div>
                <div id="story-pause-zone" class="absolute left-1/3 top-0 h-full w-1/3 z-20"></div>
                <div id="story-next-zone" class="absolute right-0 top-0 h-full w-1/3 z-20"></div>
                <div class="absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/70 to-transparent z-10">
                     <p id="story-modal-text" class="text-white text-center text-lg font-medium"></p>
                </div>
            </div>
        </div>
        
        <!-- MODAL DO EVENTO PADR√ÉO (inicialmente oculto) -->
        <div id="ticket-event-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50 hidden cursor-pointer">
            <div class="bg-gradient-to-br from-amber-600 to-orange-700 rounded-2xl shadow-2xl w-full max-w-sm text-white p-6 relative cursor-default transform transition-transform duration-300 scale-95 opacity-0">
                <div class="text-center mb-4">
                    <h3 class="text-sm font-bold uppercase text-amber-200">Voc√™ ganhou um vale-presente!</h3>
                    <h2 id="ticket-event-modal-title" class="text-3xl font-bold mt-1"></h2>
                </div>
                <div class="flex items-center justify-center my-8">
                    <div class="w-24 h-24 bg-white/20 rounded-lg flex flex-col items-center justify-center shadow-inner">
                        <div class="text-xs font-bold text-white uppercase">Data</div>
                        <div id="calendar-animation" class="text-5xl font-bold">??</div>
                        <div class="text-xs font-bold text-amber-200">EM BREVE</div>
                    </div>
                </div>
                <div class="bg-white/80 rounded-lg p-3 text-center">
                    <p id="ticket-main-text" class="font-bold text-xl text-amber-800"></p>
                    <p id="ticket-sub-text" class="text-xs text-gray-600"></p>
                </div>
            </div>
        </div>
        
        <!-- MODAL DO EVENTO CINEMA (inicialmente oculto) -->
        <div id="cinema-event-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50 hidden cursor-pointer">
             <div class="bg-gradient-to-br from-indigo-600 to-purple-700 rounded-2xl shadow-2xl w-full max-w-sm text-white p-6 relative cursor-default transform transition-transform duration-300 scale-95 opacity-0">
                <div class="text-center mb-4">
                    <h3 class="text-sm font-bold uppercase text-indigo-200">Um presente especial para n√≥s!</h3>
                    <h2 id="cinema-event-modal-title" class="text-3xl font-bold mt-1"></h2>
                </div>
                <div class="flex items-center justify-center space-x-4 my-8">
                    <div class="w-24 h-24 bg-white/20 rounded-lg flex flex-col items-center justify-center shadow-inner">
                         <div class="text-7xl font-bold text-white">‚àû</div>
                    </div>
                    <div class="text-center">
                       <svg class="w-16 h-16 text-purple-300" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M18 3v2h-2V3H8v2H6V3H4v18h2v-2h2v2h8v-2h2v2h2V3h-2zM8 17H6v-2h2v2zm0-4H6v-2h2v2zm0-4H6V7h2v2zm10 8h-2v-2h2v2zm0-4h-2v-2h2v2zm0-4h-2V7h2v2z"></path></svg>
                    </div>
                </div>
                <div class="bg-white/80 rounded-lg p-3 text-center">
                    <p class="font-bold text-xl text-indigo-800">Vale Sess√µes Infinitas</p>
                    <p class="text-xs text-gray-600">Para todas as vezes que quisermos.</p>
                </div>
            </div>
        </div>

         <!-- MODAL DO EVENTO ALEATORIO (inicialmente oculto) -->
        <div id="random-event-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50 hidden cursor-pointer">
             <div class="bg-gradient-to-br from-teal-500 to-cyan-600 rounded-2xl shadow-2xl w-full max-w-sm text-white p-6 relative cursor-default transform transition-transform duration-300 scale-95 opacity-0">
                <div class="text-center mb-4">
                    <h3 class="text-sm font-bold uppercase text-cyan-200">Um presente surpresa!</h3>
                    <h2 id="random-event-modal-title" class="text-3xl font-bold mt-1"></h2>
                </div>
                <div class="flex items-center justify-center my-8">
                    <div class="w-24 h-24 bg-white/20 rounded-lg flex flex-col items-center justify-center shadow-inner">
                         <div class="text-7xl font-bold text-white">‚àû</div>
                    </div>
                </div>
                <div class="bg-white/80 rounded-lg p-3 text-center">
                    <p class="font-bold text-xl text-teal-800">Vales Infinitos</p>
                    <p class="text-xs text-gray-600">A escolha √© sua!</p>
                </div>
            </div>
        </div>
    </div>


    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // --- L√ìGICA DA SENHA ---
            const passwordPage = document.getElementById('password-page');
            const appContainer = document.getElementById('app-container');
            const passwordForm = document.getElementById('password-form');
            const passwordInput = document.getElementById('password-input');
            const errorMessage = document.getElementById('error-message');
            const correctPassword = "guieju";

            const staticLyricsPreview = "Sabe de uma coisa? Voc√™ sempre foi a minha primeira op√ß√£o, a minha paix√£o de anos e anos. Eu lembro que sempre que come√ßava a conhecer uma menina, eu n√£o deixava passar demais porque eu era apaixonado por voc√™...";

            passwordForm.addEventListener('submit', function(event) {
                event.preventDefault();
                passwordInput.blur(); // Remove o foco do campo de senha
                if (passwordInput.value.toLowerCase() === correctPassword) {
                    // Anima√ß√£o de fade out para a p√°gina de senha
                    passwordPage.classList.add('transition-opacity', 'duration-500', 'opacity-0');
                    setTimeout(() => {
                        passwordPage.classList.add('hidden');
                        // Mostra o conte√∫do principal
                        appContainer.classList.remove('hidden');
                    }, 500); // Corresponde √† dura√ß√£o da transi√ß√£o
                } else {
                    // Mostra a mensagem de erro e treme o input
                    errorMessage.classList.remove('hidden');
                    passwordInput.classList.add('border-red-500');
                    passwordPage.classList.add('animate-shake');
                    passwordInput.value = ""; 

                    setTimeout(() => {
                        errorMessage.classList.add('hidden');
                        passwordInput.classList.remove('border-red-500');
                        passwordPage.classList.remove('animate-shake');
                    }, 1500);
                }
            });
            
            // L√≥gica para definir o favicon dinamicamente
            const faviconLink = document.getElementById('favicon');
            const imgPng = new Image();
            imgPng.src = 'favicon.png';
            imgPng.onload = function() {
                faviconLink.href = 'favicon.png';
            };
            imgPng.onerror = function() {
                // Se o .png falhar, tenta carregar o .jpg
                faviconLink.href = 'favicon.jpg';
            };

            // --- CONFIGURA√á√ÉO DOS DADOS ---
            const storiesData = [
                {
                    title: 'O In√≠cio',
                    images: [
                                    { caption: 'Se conhecemos bem antes dessa foto' }, { caption: 'Mas nessa foto a nossa idade era' }, { caption: '5 anos' }, { caption: '7 anos' }                    ]
                },
                {
                    title: 'Prega√ß√£o',
                    images: [
                        { caption: 'Viviamos no campo' }, { caption: '...' }, { caption: '√ì o g√°s' }, { caption: '...' },
                        { caption: 'Companheiros de sempre' }, { caption: 'As crian√ßas sempre ao seu redor' }, { caption: 'Muitos rurais' }, { caption: '...' },
                        { caption: 'Q?' }, { caption: '...' }, { caption: '...' }, { caption: 'Impossivel colocar todas as fotos' },
                        { caption: 'Temos muitas fotos no campo juntos' }
                    ]
                },
                {
                    title: 'Cinemas',
                    images: [
                        { caption: 'Doces e mais Doces' }, { caption: 'O Trio Mocot√≥' }, { caption: '...' }, { caption: '...' },
                        { caption: '...' }, { caption: '...' }, { caption: '...' }, { caption: 'A gente junto era...' },
                        { caption: 'Inevit√°vel' }, { caption: '...' }, { caption: '...' }, { caption: '...' },
                        { caption: '...' }, { caption: 'Lilo Lilo Crocodilo' }, { caption: '...' }
                    ]
                },
                {
                    title: 'Pais',
                    images: [
                        { caption: 'Prox. vez vamos a carater' }, { caption: '...' }, { caption: 'Nunca mais como pistache' }, { caption: 'Uuuuuuuh' }
                    ]
                },
                {
                    title: 'Risadas',
                    images: [
                        { caption: 'As risadas' }, { caption: 'Fazem parte da gente' }, { caption: 'AU AU' }, { caption: '...' },
                        { caption: '...' }, { caption: 'Cora√ß√£o at√© errou a batida' }, { caption: '...' }, { caption: '...' },
                        { caption: 'E se?' }, { caption: '...' }, { caption: '...' }, { caption: '...' },
                        { caption: '...' }, { caption: 'A nossa Vibe' }, { caption: '...' }, { caption: '...' },
                        { caption: 'Bagun√ßa Garantida' }, { caption: 'Mo√ßa? Garotos?' }, { caption: '...' }, { caption: '...' }
                    ]
                },
                {
                    title: 'Momentos',
                    images: [
                        { caption: '...' }, { caption: 'Viviamos' }, { caption: 'no' }, { caption: 'Boliche' },
                        { caption: 'Te ensinando TRUCO!' }, { caption: 'Seus primeiros DRINKS' }, { caption: 'Dirigindo meu carro sem carta' }, { caption: 'A gente andando sem vela' },
                        { caption: '...' }, { caption: '...' }, { caption: '...' }, { caption: '...' },
                        { caption: '...' }, { caption: '...' }, { caption: '...' }, { caption: '...' },
                        { caption: '...' }, { caption: '...' }, { caption: '...' }, { caption: '...' }, 
                        { caption: 'Furando' }, { caption: 'A Pandemia' }, { caption: 'Finalmente conseguiu sua CNH' }, { caption: 'Nossa 1¬∞ Viagem para o Rio' },
                        { caption: 'Comentou na minha joias' }, { caption: 'Bar e' }, { caption: 'Mais Bar' }, { caption: 'Vendo Roupa no Paraguai' },
                        { caption: 'Bebendo em outro Pa√≠s' }, { caption: 'Argentina' }, { caption: 'Pega esse Casalz√£o' }, { caption: '2¬∞ Viagem para o Rio' },
                        { caption: 'Um rolezin s√≥ nosso' }, { caption: 'Por mais dias assim' }, { caption: '...' }, { caption: 'Um dia muito especial' },
                        { caption: 'Estavamos LINDOS' }, { caption: 'Casando seu irm√£o' }, { caption: 'E meu melhor amigo' }, { caption: '...' },
                        { caption: 'Muito Fofoooos' }, { caption: '...' }, { caption: 'Inimigos do Fim' }, { caption: '...' },
                        { caption: '...' }, { caption: 'Nem ama um gelato' }, { caption: 'Furando' }, { caption: '2¬∞ Furo' },
                        { caption: 'Abdominal Temos' }
                    ]
                },
                {
                    title: 'Arcade',
                    images: [
                        { caption: 'Seu primeiro anel Pandora' }, { caption: 'Comendo como se nao houvesse amanh√£' }, { caption: 'Passeando nos Cosm√©ticos' }, { caption: 'No seu olhar' },
                        { caption: 'No meu olhar' }, { caption: 'J√° com o dedo Baga√ßado' }, { caption: 'Cabine de fotoooos' }, { caption: 'üòò' }
                    ]
                }
            ];

            const eventsData = [
                { title: 'Beto Carrero', type: 'ticket', mainText: 'Vale 1 Ingresso', subText: 'Para um dia de adrenalina!'},
                { title: 'Cinema', type: 'cinema' },
                { title: 'Holambra', type: 'ticket', mainText: 'Vale 1 Passeio', subText: 'Para um dia entre as flores.'},
                { title: 'S√£o Roque', type: 'random', mainText: 'Almo√ßo e Passeio', subText: 'Um brinde a n√≥s na rota do vinho.' },
                { title: 'Aleat√≥rio', type: 'random' }
            ];
            
            // --- PLAYLIST DE M√öSICAS ---
            const musicPlaylist = [
                { url: 'audio/Indians-Oblivion.mp3', title: 'Nossa Trilha Sonora', artist: 'Gui & Ju', lyrics: `...`  },
                { url: 'audio/Jorge-e-Mateus-Pra-que-Entender.mp3', title: 'Est√° apenas come√ßando', artist: 'Gui & Ju', lyrics: `...` },
                { url: 'audio/Tiago-Iorc-Sorte.mp3', title: 'Cada nota, um Beijo', artist: 'Gui & Ju', lyrics: `...` },
                { url: 'audio/Grouplove-Let-Me-In.mp3', title: 'Cada acorde, um abra√ßo', artist: 'Gui & Ju', lyrics: `...` },
                { url: 'audio/Cristiano-Araujo-N√£o-Sei-Me-Controlar.mp3', title: 'Nossas risadas em E maior', artist: 'Gui & Ju', lyrics: `...` },
                { url: 'audio/Armandinho-Eu-Juro.mp3', title: 'Seu olhar em verso e refr√£o', artist: 'Gui & Ju', lyrics: `...` },
                { url: 'audio/Shawn-Mendes-Always-Been-You.mp3', title: 'Uma can√ß√£o de n√≥s dois', artist: 'Gui & Ju', lyrics: `...` },
                { url: 'audio/Taylor-Swift-Daylight.mp3', title: 'Escrita a cada dia', artist: 'Gui & Ju', lyrics: `...` },
                { url: 'audio/Maroon-5-Sugar.mp3', title: 'Cora√ß√µes no mesmo ritmo', artist: 'Gui & Ju', lyrics: `...` },
                { url: 'audio/Jason-Mraz-I-Wont-Give-Up.mp3', title: 'Em uma mesma pulsa√ß√£o', artist: 'Gui & Ju', lyrics: `...` },
                { url: 'audio/Bryan-Behr-A-Vida-√â-Boa-Com-Voc√™.mp3', title: 'Uma s√≥ melodia', artist: 'Gui & Ju', lyrics: `...` },
                { url: 'audio/Onze20-Meu-Lugar.mp3', title: 'Em perfeita harmonia', artist: 'Gui & Ju', lyrics: `...` },
                { url: 'audio/Upstate-My-Heart-Is-Home.mp3', title: 'Num tom que √© s√≥ nosso', artist: 'Gui & Ju', lyrics: `...` },
                { url: 'audio/Mariana-Nolasco-All-Star.mp3', title: 'Afinada em amor', artist: 'Gui & Ju', lyrics: `...` },
                { url: 'audio/John-Mayer-XO.mp3', title: 'E para sempre em play', artist: 'Gui & Ju', lyrics: `...`},
                { url: 'audio/Rihanna-You-Da-One.mp3', title: '‚ô°', artist: 'Gui & Ju', lyrics: `...`}
            ];

            let currentTrackIndex = 0;

            // --- L√ìGICA DO SITE ---
            const audio = document.getElementById('audio-player');
            const albumArtContainer = document.getElementById('album-art-container');
            const songTitleElement = document.getElementById('song-title');
            const songArtistElement = document.getElementById('song-artist');
            const lyricsSongTitleElement = document.getElementById('lyrics-song-title');
            const mainPlayBtn = document.getElementById('main-play-btn');
            const lyricsPlayBtn = document.getElementById('lyrics-play-btn');
            const mainNextBtn = document.getElementById('main-next-btn');
            const mainPrevBtn = document.getElementById('main-prev-btn');
            const lyricsNextBtn = document.getElementById('lyrics-next-btn');
            const lyricsPrevBtn = document.getElementById('lyrics-prev-btn');
            const mainProgressBar = document.getElementById('main-progress-bar');
            const lyricsProgressBar = document.getElementById('lyrics-progress-bar');
            const mainProgress = document.getElementById('main-progress');
            const lyricsProgress = document.getElementById('lyrics-progress');
            const mainCurrentTime = document.getElementById('main-current-time');
            const lyricsCurrentTime = document.getElementById('lyrics-current-time');
            const mainTotalTime = document.getElementById('main-total-time');
            const lyricsTotalTime = document.getElementById('lyrics-total-time');
            const lyricsCardTitle = document.getElementById('lyrics-card-title');
            const lyricsCardPreview = document.getElementById('lyrics-card-preview');
            const playIconSvg = `<svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"></path></svg>`;
            const pauseIconSvg = `<svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1zm4 0a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg>`;
            const notification = document.getElementById('notification');
            const notificationSongName = document.getElementById('notification-song-name');
            let notificationTimeout;

            // --- L√ìGICA DAS ABAS DE LETRAS (MOVIDO PARA CIMA) ---
            let selectedLyricsTab = 'our'; // 'our' or 'song'
            const ourLyricsContent = document.getElementById('our-lyrics-content');
            const songLyricsContent = document.getElementById('song-lyrics-content');

            function showNotification(message) {
                if (notificationTimeout) {
                    clearTimeout(notificationTimeout);
                }
                notificationSongName.textContent = message; // Agora usamos para qualquer notifica√ß√£o
                notification.classList.remove('opacity-0', '-translate-y-10'); // Anima para dentro

                notificationTimeout = setTimeout(() => {
                    notification.classList.add('opacity-0', '-translate-y-10'); // Anima para fora
                }, 3000); // A notifica√ß√£o some ap√≥s 3 segundos
            }
            
            // --- L√ìGICA DE REGISTRO DO SERVICE WORKER (NOVO) ---
            // Colocada aqui ap√≥s a defini√ß√£o da fun√ß√£o showNotification
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/sw.js') // CORRE√á√ÉO: Alterado de './sw.js' para '/sw.js' para usar um caminho absoluto
                    .then(reg => console.log('Service Worker registrado com sucesso:', reg))
                    .catch(err => console.error('Falha ao registrar Service Worker:', err));

                // Ouvinte para mensagens do Service Worker
                navigator.serviceWorker.addEventListener('message', event => {
                    const downloadBtn = document.getElementById('download-offline-btn');
                    const downloadText = document.getElementById('download-offline-text');

                    if (event.data.type === 'CACHE_COMPLETE') {
                        showNotification('Conte√∫do salvo! O app agora funciona offline.');
                        if(downloadBtn) {
                            downloadText.textContent = 'Salvo Offline';
                            downloadBtn.disabled = true;
                        }
                    } else if (event.data.type === 'CACHE_ERROR') {
                        showNotification('Erro ao salvar. Tente novamente.');
                         if(downloadBtn) {
                            downloadText.textContent = 'Tentar Novamente';
                            downloadBtn.disabled = false;
                        }
                        console.error('Erro no cache do SW:', event.data.error);
                    }
                });
            }
            // --- FIM DA L√ìGICA DO SERVICE WORKER ---


            function loadTrack(trackIndex, direction = 'none') {
                const track = musicPlaylist[trackIndex];

                // Usa o t√≠tulo e artista definidos na playlist para a interface
                songTitleElement.textContent = track.title;
                songArtistElement.textContent = track.artist;
                lyricsSongTitleElement.textContent = track.title;

                const newImageSrcJpg = `nossafoto${trackIndex + 1}.jpg`;
                const newImg = document.createElement('img');
                newImg.src = newImageSrcJpg;
                newImg.alt = "Capa da nossa m√∫sica";
                newImg.className = "absolute top-0 left-0 w-full h-full object-cover transition-transform duration-500 ease-in-out";
                newImg.onerror = function() { handleImageError(this); };
                const oldImg = albumArtContainer.querySelector('img');
                if (direction === 'next') {
                    newImg.style.transform = 'translateX(100%)';
                    albumArtContainer.appendChild(newImg);
                    setTimeout(() => {
                        if (oldImg) oldImg.style.transform = 'translateX(-100%)';
                        newImg.style.transform = 'translateX(0)';
                    }, 10);
                } else if (direction === 'prev') {
                    newImg.style.transform = 'translateX(-100%)';
                    albumArtContainer.appendChild(newImg);
                    setTimeout(() => {
                        if (oldImg) oldImg.style.transform = 'translateX(100%)';
                        newImg.style.transform = 'translateX(0)';
                    }, 10);
                } else { 
                    albumArtContainer.innerHTML = '';
                    albumArtContainer.appendChild(newImg);
                }
                if (oldImg && direction !== 'none') {
                    setTimeout(() => oldImg.remove(), 500);
                }
                audio.src = track.url;
                audio.load();

                // Atualiza o conte√∫do da aba "M√∫sica"
                if (track.lyrics) {
                    songLyricsContent.innerText = track.lyrics; // Use innerText para respeitar quebras de linha com 'whitespace-pre-line'
                } else {
                    songLyricsContent.innerText = "Letra n√£o dispon√≠vel para esta m√∫sica.";
                }

                // ATUALIZADO: Atualiza a pr√©via no card se a aba "M√∫sica" estiver selecionada
                if (selectedLyricsTab === 'song') {
                    lyricsCardPreview.textContent = getLyricsPreview(track.lyrics);
                }
            }

            function playMusic() {
                audio.play().catch(error => console.log("Autoplay impedido.", error));
                mainPlayBtn.innerHTML = pauseIconSvg;
                mainPlayBtn.classList.remove('pulse-play');
                lyricsPlayBtn.innerHTML = pauseIconSvg;

                // Extrai o nome do arquivo da URL APENAS para a notifica√ß√£o
                const currentTrack = musicPlaylist[currentTrackIndex];
                const url = currentTrack.url;
                const fileNameWithQuery = url.substring(url.lastIndexOf('/') + 1);
                const fileName = fileNameWithQuery.split('?')[0];
                const decodedFileName = decodeURIComponent(fileName);

                showNotification(`Tocando: ${decodedFileName}`);
            }

            function pauseMusic() {
                audio.pause();
                mainPlayBtn.innerHTML = playIconSvg;
                 mainPlayBtn.classList.add('pulse-play');
                lyricsPlayBtn.innerHTML = playIconSvg;
            }

            function playNext() {
                currentTrackIndex = (currentTrackIndex + 1) % musicPlaylist.length;
                loadTrack(currentTrackIndex, 'next');
                playMusic();
            }

            function playPrevious() {
                currentTrackIndex = (currentTrackIndex - 1 + musicPlaylist.length) % musicPlaylist.length;
                loadTrack(currentTrackIndex, 'prev');
                playMusic();
            }

            function togglePlayPause() {
                if (audio.src && audio.paused) {
                    playMusic();
                } else {
                    pauseMusic();
                }
            }
            
            function formatTime(seconds) {
                const minutes = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${minutes}:${secs < 10 ? '0' : ''}${secs}`;
            }

            function getLyricsPreview(lyrics) {
                if (!lyrics || lyrics.startsWith('Letra da m√∫sica') || lyrics.trim() === '') {
                    return "Letra n√£o dispon√≠vel para esta m√∫sica.";
                }

                // Define o tamanho m√°ximo da pr√©via (pr√≥ximo ao da "Nossa Letra")
                const maxLength = 200; 

                // Limpa o texto: remove espa√ßos no in√≠cio/fim e substitui quebras de linha por um espa√ßo
                let previewText = lyrics.trim().replace(/\n/g, ' '); 
                // Substitui m√∫ltiplos espa√ßos (criados pela quebra de linha) por um √∫nico espa√ßo
                previewText = previewText.replace(/\s+/g, ' ');

                if (previewText.length > maxLength) {
                    return previewText.substring(0, maxLength) + "...";
                }
                
                return previewText; // Se for menor, retorna o texto limpo (sem "...")
            }

            function updateProgress() {
                if (audio.duration) {
                    const progressPercent = (audio.currentTime / audio.duration) * 100;
                    mainProgress.style.width = `${progressPercent}%`;
                    lyricsProgress.style.width = `${progressPercent}%`;
                    mainCurrentTime.textContent = formatTime(audio.currentTime);
                    lyricsCurrentTime.textContent = formatTime(audio.currentTime);
                }
            }
            
            function setProgress(e, progressBar) {
                const width = progressBar.clientWidth;
                const clickX = e.offsetX;
                const duration = audio.duration;
                if (duration) {
                    audio.currentTime = (clickX / width) * duration;
                }
            }

            mainPlayBtn.addEventListener('click', togglePlayPause);
            lyricsPlayBtn.addEventListener('click', togglePlayPause);
            mainNextBtn.addEventListener('click', playNext);
            mainPrevBtn.addEventListener('click', playPrevious);
            lyricsNextBtn.addEventListener('click', playNext);
            lyricsPrevBtn.addEventListener('click', playPrevious);
            audio.addEventListener('timeupdate', updateProgress);
            audio.addEventListener('loadedmetadata', () => {
                mainTotalTime.textContent = formatTime(audio.duration);
                lyricsTotalTime.textContent = formatTime(audio.duration);
                updateProgress();
            });
            audio.addEventListener('ended', playNext);
            mainProgressBar.addEventListener('click', (e) => setProgress(e, mainProgressBar));
            lyricsProgressBar.addEventListener('click', (e) => setProgress(e, lyricsProgressBar));

            loadTrack(currentTrackIndex);
            pauseMusic();
            
            // --- L√≥gica de Swipe na Capa do √Ålbum (Removida) ---

            const mainPage = document.getElementById('main-page');
            const lyricsPage = document.getElementById('lyrics-page');
            const lyricsCard = document.getElementById('lyrics-card');
            const backToMainBtn = document.getElementById('back-to-main-btn');
            const storiesContainer = document.getElementById('stories-container');
            const eventsContainer = document.getElementById('events-container');
            const storyModal = document.getElementById('story-modal');
            const closeStoryBtn = document.getElementById('close-story-btn');
            const lyricsContent = document.getElementById('lyrics-content');

            // --- L√ìGICA DAS ABAS DE LETRAS ---
            const mainOurLyricsTab = document.getElementById('main-our-lyrics-tab');
            const mainSongLyricsTab = document.getElementById('main-song-lyrics-tab');

            lyricsCard.addEventListener('click', () => {
                console.log("Abrindo modal de letra. Aba selecionada:", selectedLyricsTab); // DEBUG
                lyricsPage.style.transform = '';
                lyricsPage.classList.remove('hidden');
                mainPage.classList.add('hidden');
                
                // CORRE√á√ÉO: L√≥gica para mostrar/esconder o conte√∫do correto
                if (selectedLyricsTab === 'our') {
                    console.log("Mostrando 'Nossa Letra', escondendo 'M√∫sica'"); // DEBUG
                    ourLyricsContent.classList.remove('hidden');
                    songLyricsContent.classList.add('hidden');
                } else {
                    console.log("Mostrando 'M√∫sica', escondendo 'Nossa Letra'"); // DEBUG
                    songLyricsContent.classList.remove('hidden');
                    ourLyricsContent.classList.add('hidden');
                }
            });

            function closeLyricsPage() {
                mainPage.classList.remove('hidden');
                lyricsPage.classList.add('hidden');
            }

            backToMainBtn.addEventListener('click', closeLyricsPage);

            mainOurLyricsTab.addEventListener('click', () => {
                selectedLyricsTab = 'our';
                // Ativa a tab "Nossa Letra"
                mainOurLyricsTab.classList.add('text-white', 'border-white');
                mainOurLyricsTab.classList.remove('text-white/70', 'border-transparent');
                // Desativa a tab "M√∫sica"
                mainSongLyricsTab.classList.add('text-white/70', 'border-transparent');
                mainSongLyricsTab.classList.remove('text-white', 'border-white');

                // ATUALIZADO: Muda o t√≠tulo e a pr√©via do card
                lyricsCardTitle.textContent = "Nossa Letra";
                lyricsCardPreview.textContent = staticLyricsPreview;
            });

            mainSongLyricsTab.addEventListener('click', () => {
                selectedLyricsTab = 'song';
                // Ativa a tab "M√∫sica"
                mainSongLyricsTab.classList.add('text-white', 'border-white');
                mainSongLyricsTab.classList.remove('text-white/70', 'border-transparent');
                // Desativa a tab "Nossa Letra"
                mainOurLyricsTab.classList.add('text-white/70', 'border-transparent');
                mainOurLyricsTab.classList.remove('text-white', 'border-white');

                // ATUALIZADO: Muda o t√≠tulo e a pr√©via do card
                const currentTrack = musicPlaylist[currentTrackIndex];
                lyricsCardTitle.textContent = "Letra da M√∫sica";
                lyricsCardPreview.textContent = getLyricsPreview(currentTrack.lyrics);
            });


            // --- L√ìGICA DOS STORIES ---
            const storyPrefixes = ['A', 'B', 'C', 'D', 'E', 'G', 'H'];
            let currentStoryIndex = 0;
            let currentStoryImageSubIndex = 0;
            let storyTimer;
            let isStoryPaused = false;
            let storyStartTime;
            let storyTimeLeft;
            const STORY_DURATION = 5000; // 5 segundos

            const storyModalAvatar = document.getElementById('story-modal-avatar');
            const storyModalTitle = document.getElementById('story-modal-title');
            const storyModalImage = document.getElementById('story-modal-image');
            const storyModalText = document.getElementById('story-modal-text');
            const storyPrevZone = document.getElementById('story-prev-zone');
            const storyNextZone = document.getElementById('story-next-zone');
            const storyPauseZone = document.getElementById('story-pause-zone');
            const storyPauseBtn = document.getElementById('story-pause-btn');
            const storyPauseIcon = `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 5.25v13.5m-7.5-13.5v13.5" /></svg>`;
            const storyPlayIcon = `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z" /></svg>`;


            storiesData.forEach((story, index) => {
                const storyElement = document.createElement('div');
                storyElement.className = 'flex flex-col items-center flex-shrink-0 w-16';
                const prefix = storyPrefixes[index];
                const thumbnailSrc = `${prefix}/${prefix}1.jpg`;
                storyElement.innerHTML = `
                    <div class="w-14 h-14 rounded-full p-0.5 bg-gradient-to-tr from-yellow-400 via-red-500 to-purple-500">
                        <img src="${thumbnailSrc}" class="w-full h-full rounded-full object-cover border-2 border-black" onerror="handleImageError(this)">
                    </div>
                    <span class="text-xs mt-1 text-center text-gray-300">${story.title}</span>`;
                storyElement.addEventListener('click', () => openStory(index));
                storiesContainer.appendChild(storyElement);
            });
            
            function openStory(storyIndex) {
                currentStoryIndex = storyIndex;
                currentStoryImageSubIndex = 0;
                isStoryPaused = false;
                storyPauseBtn.innerHTML = storyPauseIcon;
                
                // CORRE√á√ÉO: Reseta os estilos inline que podem ter sido deixados pelo gesto de arrastar para fechar
                storyModal.style.transform = '';
                storyModal.style.opacity = '';
                
                storyModal.classList.remove('hidden');
                storyModal.classList.add('flex');

                // Tenta entrar em tela cheia no elemento da p√°gina inteira para m√°xima compatibilidade
                const elem = document.documentElement;
                if (elem.requestFullscreen) {
                    elem.requestFullscreen().catch(err => {
                        console.log(`Erro ao tentar entrar em tela cheia: ${err.message} (${err.name})`);
                    });
                } else if (elem.webkitRequestFullscreen) { // Safari
                    elem.webkitRequestFullscreen();
                }
                
                updateStoryView();
            }
            
            function updateStoryView() {
                const story = storiesData[currentStoryIndex];
                const prefix = storyPrefixes[currentStoryIndex];
                storyModalTitle.innerText = story.title;
                storyModalAvatar.src = `${prefix}/${prefix}1.jpg`;
                
                loadStoryImage();
            }
            
            function preloadImage(url) {
                return new Promise((resolve, reject) => {
                    const img = new Image();
                    img.src = url;
                    img.onload = resolve;
                    img.onerror = reject;
                });
            }

            async function loadStoryImage(isPreloading = false) {
                if (storyTimer) clearTimeout(storyTimer);

                const story = storiesData[currentStoryIndex];
                if (!story || !story.images[currentStoryImageSubIndex]) {
                    closeStory();
                    return;
                }
                const imageInfo = story.images[currentStoryImageSubIndex];
                const prefix = storyPrefixes[currentStoryIndex];
                const imageName = `${prefix}/${prefix}${currentStoryImageSubIndex + 1}.jpg`;

                storyModalImage.classList.add('opacity-0');

                try {
                    await preloadImage(imageName);
                    storyModalImage.src = imageName;
                    storyModalImage.classList.remove('opacity-0');
                    storyModalText.innerText = imageInfo.caption;
                    
                    if (!isStoryPaused) {
                         storyStartTime = Date.now();
                         storyTimer = setTimeout(nextStoryImage, STORY_DURATION);
                    }
                    
                    // Preload da pr√≥xima imagem
                    if (currentStoryImageSubIndex + 1 < story.images.length) {
                        const nextPrefix = storyPrefixes[currentStoryIndex];
                        const nextImageName = `${nextPrefix}/${nextPrefix}${currentStoryImageSubIndex + 2}.jpg`;
                        preloadImage(nextImageName);
                    }
                } catch (error) {
                    console.error("Erro ao carregar imagem:", imageName);
                    nextStoryImage(); // Pula para a pr√≥xima se houver erro
                }
            }

            function nextStoryImage() {
                const story = storiesData[currentStoryIndex];
                if (currentStoryImageSubIndex < story.images.length - 1) {
                    currentStoryImageSubIndex++;
                    loadStoryImage();
                } else if (currentStoryIndex < storiesData.length - 1) {
                    currentStoryIndex++;
                    currentStoryImageSubIndex = 0;
                    updateStoryView();
                } else {
                    closeStory();
                }
            }

            function prevStoryImage() {
                if (currentStoryImageSubIndex > 0) {
                    currentStoryImageSubIndex--;
                    loadStoryImage();
                } else if (currentStoryIndex > 0) {
                    currentStoryIndex--;
                    currentStoryImageSubIndex = storiesData[currentStoryIndex].images.length - 1;
                    updateStoryView();
                } else {
                     loadStoryImage();
                }
            }
            
            function toggleStoryPause() {
                isStoryPaused = !isStoryPaused;

                if (isStoryPaused) {
                    storyPauseBtn.innerHTML = storyPlayIcon;
                    clearTimeout(storyTimer);
                    storyTimeLeft = STORY_DURATION - (Date.now() - storyStartTime);
                } else {
                    storyPauseBtn.innerHTML = storyPauseIcon;
                    storyStartTime = Date.now(); // Reinicia o tempo para o restante
                    storyTimer = setTimeout(nextStoryImage, storyTimeLeft);
                }
            }

            function closeStory() {
                if (storyTimer) clearTimeout(storyTimer);
                storyModal.classList.add('hidden');
                storyModal.classList.remove('flex');

                // Sai da tela cheia se o documento estiver em modo de tela cheia
                if (document.fullscreenElement || document.webkitFullscreenElement) {
                    if (document.exitFullscreen) {
                        document.exitFullscreen();
                    } else if (document.webkitExitFullscreen) { // Safari
                        document.webkitExitFullscreen();
                    }
                }
            }

            storyPauseBtn.addEventListener('click', toggleStoryPause);
            storyPauseZone.addEventListener('click', toggleStoryPause);
            closeStoryBtn.addEventListener('click', closeStory);
            storyNextZone.addEventListener('click', nextStoryImage);
            storyPrevZone.addEventListener('click', prevStoryImage);
            
            // --- L√ìGICA DOS EVENTOS ---
            const eventModal = document.getElementById('ticket-event-modal');
            const cinemaEventModal = document.getElementById('cinema-event-modal');
            const randomEventModal = document.getElementById('random-event-modal');
            
            let calendarInterval;

            eventsData.forEach((event, index) => {
                const eventElement = document.createElement('div');
                const imageSrc = `F${index + 1}.jpg`;
                eventElement.className = 'flex flex-col items-center flex-shrink-0 w-16 text-center cursor-pointer';
                eventElement.innerHTML = `
                    <div class="w-14 h-14 rounded-full">
                        <img src="${imageSrc}" class="w-full h-full rounded-full object-cover border-2 border-gray-600" onerror="handleImageError(this)">
                    </div>
                    <span class="text-xs mt-1 text-gray-300">${event.title}</span>`;
                eventElement.addEventListener('click', () => openEventModal(event));
                eventsContainer.appendChild(eventElement);
            });

            function openEventModal(event) {
                const modalId = `${event.type}-event-modal`;
                const modal = document.getElementById(modalId);
                if (!modal) return;
                
                const ticket = modal.querySelector('div');
                const title = modal.querySelector('h2');

                if(title) title.textContent = event.title;
                modal.classList.remove('hidden');
                setTimeout(() => {
                   ticket.classList.remove('scale-95', 'opacity-0');
                }, 10);
                
                if (event.type === 'ticket') {
                    const calendarAnimation = document.getElementById('calendar-animation');
                    const ticketMainText = document.getElementById('ticket-main-text');
                    const ticketSubText = document.getElementById('ticket-sub-text');
                    
                    if (ticketMainText) ticketMainText.textContent = event.mainText;
                    if (ticketSubText) ticketSubText.textContent = event.subText;

                    if(calendarInterval) clearInterval(calendarInterval);
                    calendarInterval = setInterval(() => {
                        calendarAnimation.textContent = Math.floor(Math.random() * 30) + 1;
                    }, 80);
                }
            }

            function closeModal(modal) {
                 const ticket = modal.querySelector('div');
                 if(modal.id === 'ticket-event-modal' && calendarInterval) clearInterval(calendarInterval);
                 ticket.classList.add('scale-95', 'opacity-0');
                 setTimeout(() => {
                    modal.classList.add('hidden');
                }, 300);
            }

            eventModal.addEventListener('click', (e) => {
                if (e.target === eventModal) closeModal(eventModal);
            });
             cinemaEventModal.addEventListener('click', (e) => {
                if (e.target === cinemaEventModal) closeModal(cinemaEventModal);
            });
            randomEventModal.addEventListener('click', (e) => {
                if (e.target === randomEventModal) closeModal(randomEventModal);
            });


            // --- L√ìGICA DE ARRASTAR ---
            let touchStartY = 0;
            let currentY = 0;
            let isDragging = false;

            function addDragToCloseListener(modal, onDragStart, onDrag, onDragEnd) {
                 modal.addEventListener('touchstart', onDragStart);
                 modal.addEventListener('touchmove', onDrag);
                 modal.addEventListener('touchend', onDragEnd);
            }

            // Arrastar para fechar Story
            addDragToCloseListener(storyModal, 
                (e) => {
                    // Ignora o drag se o clique come√ßou na zona de pausa/play
                    if (e.target === storyPauseZone) {
                        isDragging = false;
                        return;
                    }
                    isDragging = true;
                    touchStartY = e.touches[0].clientY;
                    storyModal.style.transition = 'none';
                    if(storyTimer) clearTimeout(storyTimer);
                },
                (e) => {
                    if (!isDragging) return;
                    currentY = e.touches[0].clientY;
                    const diffY = currentY - touchStartY;
                    if (diffY > 0) {
                        storyModal.style.transform = `translateY(${diffY}px)`;
                        storyModal.style.opacity = 1 - (diffY / (window.innerHeight / 1.5));
                    }
                },
                () => {
                    if (!isDragging) return;
                    isDragging = false;
                    const diffY = currentY - touchStartY;
                    storyModal.style.transition = 'transform 0.3s ease, opacity 0.3s ease';
                    if (diffY > window.innerHeight / 4) {
                        storyModal.style.transform = 'translateY(100%)';
                        storyModal.style.opacity = '0';
                        setTimeout(() => closeStory(), 300);
                    } else {
                        storyModal.style.transform = 'translateY(0)';
                        storyModal.style.opacity = '1';
                        if (!isStoryPaused) {
                             storyTimer = setTimeout(nextStoryImage, storyTimeLeft || STORY_DURATION);
                        }
                    }
                }
            );

            // Arrastar para fechar Letra
            addDragToCloseListener(lyricsPage,
                (e) => {
                    // S√≥ permite arrastar se o conte√∫do da letra estiver no topo (scrollTop === 0)
                    if (lyricsContent.scrollTop === 0) {
                        isDragging = true;
                        touchStartY = e.touches[0].clientY;
                        lyricsPage.style.transition = 'none';
                    } else {
                        isDragging = false;
                    }
                },
                (e) => {
                    if (!isDragging) return;
                    currentY = e.touches[0].clientY;
                    const diffY = currentY - touchStartY;
                    if (diffY > 0) { // S√≥ permite arrastar para baixo
                        lyricsPage.style.transform = `translateY(${diffY}px)`;
                    }
                },
                () => {
                    if (!isDragging) return;
                    isDragging = false;
                    const diffY = currentY - touchStartY;
                    lyricsPage.style.transition = 'transform 0.4s cubic-bezier(0.4, 0, 0.2, 1)';
                    // Se arrastar mais que 1/4 da tela, fecha
                    if (diffY > window.innerHeight / 4) {
                        closeLyricsPage();
                    } else {
                        lyricsPage.style.transform = ''; // Volta ao normal
                    }
                }
            );

             // --- L√≥gica do Menu do Cabe√ßalho ---
            const menuBtn = document.getElementById('menu-btn');
            const headerMenu = document.getElementById('header-menu');
            const downloadBtn = document.getElementById('download-offline-btn'); // NOVO
            const downloadText = document.getElementById('download-offline-text'); // NOVO

            menuBtn.addEventListener('click', (event) => {
                event.stopPropagation(); 
                headerMenu.classList.toggle('hidden');
            });
            
            document.addEventListener('click', (event) => {
                if (!headerMenu.classList.contains('hidden') && !headerMenu.contains(event.target) && !menuBtn.contains(event.target)) {
                    headerMenu.classList.add('hidden');
                }
            });

            // --- L√ìGICA DO BOT√ÉO OFFLINE (NOVO) ---
            downloadBtn.addEventListener('click', () => {
                console.log('Bot√£o Salvar Offline clicado.');
                showNotification('Iniciando download para uso offline...');
                downloadText.textContent = 'Salvando...';
                downloadBtn.disabled = true;

                // 1. Coletar todos os assets
                // Usamos um Set para evitar duplicatas, depois convertemos para Array
                const assetsToCache = new Set([
                    '/', // A raiz do site
                    'index.html',
                    'tailwind.js',
                    'manifest.json',
                    'icons/icon-192x192.png',
                    'favicon.png',
                    'favicon.jpg',
                    's1.jpg', 's2.jpg', 's3.jpg',
                    's1.png', 's2.png', 's3.png', // Fallbacks
                    'minhafoto.jpg', 'minhafoto.png' // Fallbacks
                ]);

                // 2. Musicas
                musicPlaylist.forEach(track => {
                    assetsToCache.add(track.url);
                });

                // 3. Imagens da capa (nossafotoX.jpg/png)
                musicPlaylist.forEach((track, index) => {
                    assetsToCache.add(`nossafoto${index + 1}.jpg`);
                    assetsToCache.add(`nossafoto${index + 1}.png`); // Adiciona fallback
                });

                // 4. Imagens dos Stories (A/A1.jpg, etc)
                storiesData.forEach((story, index) => {
                    const prefix = storyPrefixes[index];
                    // Adiciona thumbnail do story
                    assetsToCache.add(`${prefix}/${prefix}1.jpg`);
                    assetsToCache.add(`${prefix}/${prefix}1.png`); // Fallback

                    // Adiciona imagens de dentro do story
                    story.images.forEach((img, subIndex) => {
                        assetsToCache.add(`${prefix}/${prefix}${subIndex + 1}.jpg`);
                        assetsToCache.add(`${prefix}/${prefix}${subIndex + 1}.png`); // Fallback
                    });
                });

                // 5. Imagens dos Eventos (F1.jpg, etc)
                eventsData.forEach((event, index) => {
                    assetsToCache.add(`F${index + 1}.jpg`);
                    assetsToCache.add(`F${index + 1}.png`); // Fallback
                });

                // ADICIONA O SCRIPT DO TAILWIND √Ä LISTA DE CACHE
                assetsToCache.add('https://cdn.tailwindcss.com');
                
                // 6. Converter o Set de volta para Array
                const uniqueAssets = Array.from(assetsToCache);
                console.log(`[App] Total de ${uniqueAssets.length} assets √∫nicos para cachear.`);

                // 7. Enviar para o Service Worker
                // CORRE√á√ÉO: Modificado para esperar o SW estar pronto (ready)
                if ('serviceWorker' in navigator) {
                    navigator.serviceWorker.ready.then(registration => {
                        if (registration.active) {
                            registration.active.postMessage({
                                type: 'CACHE_ASSETS',
                                urls: uniqueAssets
                            });
                        } else {
                            // Isso pode acontecer se o SW ativou mas algo deu errado
                            showNotification('Erro: Service Worker n√£o est√° ativo.');
                            downloadText.textContent = 'Erro. Recarregue';
                            downloadBtn.disabled = false;
                        }
                    }).catch(err => {
                        // Isso acontece se o registro falhar
                        showNotification('Erro: Falha ao preparar o Service Worker.');
                        downloadText.textContent = 'Erro. Recarregue';
                        downloadBtn.disabled = false;
                        console.error('Erro no serviceWorker.ready:', err);
                    });
                } else {
                    // Isso n√£o deve acontecer se o registro foi bem sucedido
                    showNotification('Erro: Service Worker n√£o suportado.');
                    downloadText.textContent = 'Erro.';
                    downloadBtn.disabled = true;
                }
            });
            // --- FIM DA L√ìGICA OFFLINE ---
        });
    </script>
    <script src="tailwind.js"></script>
</body>
</html>
